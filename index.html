<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Plataforma Experimental</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    transition: background 1.5s ease;
    background: black;
}

.container {
    text-align: center;
    max-width: 600px;
    padding: 20px;
}

input {
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    text-align: center;
    color: #333;
    width: 80%;
}

button {
    margin-top: 15px;
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #00c6ff;
    color: black;
    font-weight: bold;
    transition: transform 0.2s;
}

button:hover {
    transform: scale(1.05);
}

.progress-bar {
    width: 300px;
    height: 10px;
    background: #333;
    margin: 20px auto;
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    width: 0%;
    background: #00ffcc;
    transition: width 0.3s;
}

.signal {
    font-size: 40px;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { opacity: 0.3; }
    50% { opacity: 1; }
    100% { opacity: 0.3; }
}

.flash {
    animation: flashScreen 0.1s infinite;
}

@keyframes flashScreen {
    0% { background: black; }
    50% { background: #330000; }
    100% { background: black; }
}

.screenOff {
    background: black !important;
}

.bigMessage {
    font-size: 45px;
    font-weight: bold;
    color: #00ffcc;
    text-shadow: 0 0 15px #00ffcc, 0 0 30px #00ffcc;
    animation: fadeInZoom 2s ease forwards;
}

@keyframes fadeInZoom {
    0% { opacity: 0; transform: scale(0.7); }
    100% { opacity: 1; transform: scale(1); }
}

@keyframes aparecer {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.loveMessage {
    font-size: 40px;
    color: white;
    margin-bottom: 20px;
    text-shadow: 0 0 10px white;
}

.mensajeBonito {
    font-size: 22px;
    margin-top: 15px;
    opacity: 0;
    transition: opacity 1s ease;
}

.florPixel {
    font-size: 35px;
    margin-top: 15px;
    margin-bottom: 15px;
    letter-spacing: 10px;
    text-shadow: 0 0 10px rgba(255,255,255,0.5);
}

.comentarios-section {
    margin-top: 25px;
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid #00ffcc;
    animation: aparecer 1s ease forwards;
}

textarea {
    width: 90%;
    height: 60px;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    border: none;
    font-family: Arial, sans-serif;
    color: #333;
    resize: none;
}

/* Estilo hacker para el error */
.error-text {
    color: #ff3333;
    font-family: 'Courier New', Courier, monospace;
    text-align: left;
    font-size: 14px;
    background: rgba(0,0,0,0.8);
    padding: 15px;
    border-radius: 5px;
    border-left: 3px solid red;
    margin-bottom: 20px;
}
</style>
</head>

<body>

<div class="container" id="pantalla"></div>

<script>
const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbw821J3AeHNvY7VY2SGKQ4Zy573SJMMDcTBhfXaJEjFQUPapBzEq4j7U0pD3QSTY9OjUw/exec";

const params = new URLSearchParams(window.location.search);
const modo = params.get("modo");

const temasNormales = [
    {titulo:"üèç Simulaci√≥n de Telemetr√≠a Racing",descripcion:"Sistema piloto de pruebas din√°micas urbanas."},
    {titulo:"‚öΩ Plataforma de An√°lisis Deportivo",descripcion:"Evaluaci√≥n estad√≠stica avanzada de rendimiento competitivo."},
    {titulo:"üîß Diagn√≥stico Inteligente de Talleres",descripcion:"Proyecto para evaluaci√≥n digital de servicios t√©cnicos."}
];

const temaEspecial = {
    titulo:"üåç Proyecto de Observaci√≥n Ambiental",
    descripcion:"Plataforma experimental enfocada en monitoreo natural."
};

let temaSeleccionado;

if(modo==="especial1" || modo==="especial2" || modo==="especial3"){
    temaSeleccionado = temaEspecial;
    document.body.style.background="linear-gradient(to right,#134e5e,#71b280)";
}else{
    temaSeleccionado = temasNormales[Math.floor(Math.random()*temasNormales.length)];
    document.body.style.background="linear-gradient(to right,#0f2027,#203a43,#2c5364)";
}

// PANTALLA INICIAL
document.getElementById("pantalla").innerHTML=`
    <h2>Plataforma en fase experimental</h2>
    <p>Este sistema se encuentra en desarrollo y puede presentar comportamientos inesperados.</p>
    <p style="opacity:0.6;font-size:14px;">Versi√≥n Beta - Acceso limitado</p>
    <br>
    <button onclick="mostrarFormulario()">Entrar al sistema</button>
`;

function mostrarFormulario(){
    document.getElementById("pantalla").innerHTML=`
    <h1>${temaSeleccionado.titulo}</h1>
    <p>${temaSeleccionado.descripcion}</p>
    <br>
    <h3>Reg√≠strate para continuar</h3>
    <input type="text" id="nombreInput" placeholder="Ej: Yeisson Orellana">
    <br>
    <button onclick="guardarNombre()">Registrar acceso</button>
    <p style="font-size:12px;opacity:0.6;margin-top:10px; color: #ffcc00;">
    ‚ö†Ô∏è El desarrollador podr√° visualizar su nombre, fecha y hora de acceso para fines t√©cnicos.
    </p>
    `;
}

function capitalizarNombre(nombre){
    return nombre.trim().toLowerCase().split(/\s+/)
    .map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(" ");
}

async function registrarEnExcel(nombre, tipo, mensaje = "") {
    try {
        fetch(URL_GOOGLE_SCRIPT, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nombre: nombre, tipo: tipo, mensaje: mensaje })
        });
    } catch (e) { console.error("Error de registro"); }
}

async function guardarNombre(){
    let nombre=document.getElementById("nombreInput").value.trim();
    if(nombre==="") return alert("Ingresa tu nombre");
    if(nombre.split(" ").length>4) return alert("M√°ximo cuatro palabras");
    nombre = capitalizarNombre(nombre);
    registrarEnExcel(nombre, "ACCESO", "Entr√≥ a la plataforma principal");
    iniciarSecuencia(nombre);
}

// FUNCIONES DE SOPORTE
function pausa(ms){ return new Promise(resolve=>setTimeout(resolve,ms)); }

function animarBarra(){
    return new Promise(resolve=>{
        let ancho=0;
        const barra=document.getElementById("barra");
        const intervalo=setInterval(()=>{
            ancho+=5;
            barra.style.width=ancho+"%";
            if(ancho>=100){ clearInterval(intervalo); resolve(); }
        },150);
    });
}

function escribir(id,texto,velocidad){
    return new Promise(resolve=>{
        let i=0;
        const el=document.getElementById(id);
        const intervalo=setInterval(()=>{
            el.innerHTML+=texto[i];
            i++;
            if(i>=texto.length){ clearInterval(intervalo); resolve(); }
        },velocidad);
    });
}

function escribirEfectoTexto(elemento, texto, velocidad) {
    return new Promise(resolve => {
        let i = 0;
        const intervalo = setInterval(() => {
            elemento.innerHTML += texto[i];
            i++;
            if (i >= texto.length) { clearInterval(intervalo); resolve(); }
        }, velocidad);
    });
}

let resolveBotonClic;
let direccionBoton = 'next';
function clickNavegacion(dir) {
    direccionBoton = dir;
    if (resolveBotonClic) resolveBotonClic();
}

// SECUENCIA PRINCIPAL
async function iniciarSecuencia(nombreUsuario){
    document.body.style.background="linear-gradient(to right,#0f2027,#203a43,#2c5364)";
    document.body.innerHTML=`<div class="container" id="contenido"></div>`;
    const contenido=document.getElementById("contenido");

    contenido.innerHTML=`<div>Cargando usuario...</div><div class="signal">üì°</div>`;
    await pausa(2000);

    contenido.innerHTML="";
    await escribir("contenido","Estableciendo t√∫nel de conexi√≥n segura...",40);
    await pausa(1000);

    contenido.innerHTML=`<div>Sincronizando m√≥dulos del n√∫cleo...</div>
    <div class="progress-bar"><div class="progress-fill" id="barra"></div></div>`;
    await animarBarra();
    
    // El Efecto de Flash / Error
    document.body.classList.add("flash");
    await pausa(1000);
    document.body.classList.remove("flash");
    document.body.style.background="black";

    contenido.innerHTML=`
    <div class="error-text">
        [SYSTEM FAILURE]<br>
        ERROR: ACCESS_VIOLATION_0x0045<br>
        SOURCE: CORE_INTERFACE_RESTRICTION<br>
        -----------------------------------<br>
        <div id="reinicio1"></div>
        <div id="reinicio2"></div>
        <div id="reinicio3"></div>
    </div>`;
    
    await escribir("reinicio1", "> Intentando bypass de seguridad...", 30);
    await pausa(500);
    await escribir("reinicio2", "> Re-enrutando interfaz emocional...", 30);
    await pausa(500);
    await escribir("reinicio3", "> Restauraci√≥n completada. Iniciando modo humano.", 30);
    await pausa(2000);

    document.body.classList.add("screenOff");
    contenido.innerHTML="";
    await pausa(1500);
    document.body.classList.remove("screenOff");

    contenido.innerHTML=`<div class="bigMessage">"Respira... todo est√° bajo control."</div>`;
    await pausa(3500);

    let nombreBuscado = nombreUsuario.toLowerCase();
    let esMaria = nombreBuscado.includes("maria") || nombreBuscado.includes("fer") || nombreBuscado.includes("vazquez");
    let esKimberly = nombreBuscado.includes("kimberly") || nombreBuscado.includes("kim") || nombreBuscado.includes("pamela");
    let esSilvia = nombreBuscado.includes("silvia") || nombreBuscado.includes("tatiana") || nombreBuscado.includes("esperanza");

    let esVIP = false;
    if ((modo === "especial1" || modo === "especial2" || modo === "especial3") && (esMaria || esKimberly || esSilvia)) {
        esVIP = true; 
    } 

    mostrarRutaCompartida(nombreUsuario, esVIP); 
}

async function mostrarRutaCompartida(nombreUsuario, esVIP) {
    let nombreFinal = capitalizarNombre(nombreUsuario).toUpperCase();
    document.body.style.background = "linear-gradient(to right, #b30059, #800040)";
    const contenedor = document.getElementById("contenido");

    const mensajesCortos = [
        "La vida tiene detalles hermosos esperando por ti.",
        "Un peque√±o pensamiento positivo puede cambiar todo tu d√≠a.",
        "No olvides que tu luz propia es capaz de iluminar a otros.",
        "Cada d√≠a es una nueva oportunidad para volver a empezar.",
        "Mereces todo lo bonito que el mundo tiene para dar."
    ];
    mensajesCortos.sort(() => Math.random() - 0.5);

    contenedor.innerHTML = `
        <div class="loveMessage">üíñ BIENVENIDA(O) üíñ</div>
        <div class="florPixel">‚ú® üå∏ ü¶ã</div>
        <div id="mensajeSecuencia" class="mensajeBonito" style="min-height: 80px;"></div>
    `;

    const areaMensajes = document.getElementById("mensajeSecuencia");
    for(let i=0; i<3; i++){
        areaMensajes.style.opacity = "0";
        await pausa(500); 
        areaMensajes.innerText = mensajesCortos[i];
        areaMensajes.style.opacity = "1";
        await pausa(3000); 
    }

    // MENSAJES LARGOS CON BOTONES
    document.body.style.background = "linear-gradient(to right, #6a11cb, #2575fc)"; 
    const mensajesLargos = [
        "A veces la vida nos pone pruebas, pero es solo para recordarnos de qu√© estamos hechos. Tienes una fuerza interior que te hace capaz de superar cualquier obst√°culo.",
        "No te compares con nadie, tu camino es √∫nico y tu ritmo es perfecto. Lo que est√° destinado para ti llegar√° en el momento exacto.",
        "Tu historia est√° llena de cap√≠tulos hermosos que a√∫n no se han escrito. Mant√©n la esperanza alta y el coraz√≥n abierto.",
        "Si√©ntete orgulloso o orgullosa de lo mucho que has crecido. A veces somos nuestros cr√≠ticos m√°s duros, pero mereces reconocer todo tu esfuerzo."
    ];
    
    let indice = 0;
    while(indice < mensajesLargos.length){
        contenedor.innerHTML = "";
        let divNombre = document.createElement("div");
        divNombre.style.fontSize = "40px"; divNombre.style.fontWeight = "bold";
        divNombre.style.color = "#ffcc00"; divNombre.innerText = nombreFinal;
        
        let divAdornos = document.createElement("div");
        divAdornos.className = "florPixel"; divAdornos.innerText = "üå∏ ‚ú® üíñ ü¶ã";
        
        let divTexto = document.createElement("div");
        divTexto.style.fontSize = "20px"; divTexto.style.lineHeight = "1.5"; divTexto.style.maxWidth = "90%"; divTexto.style.margin = "0 auto";

        let divBotones = document.createElement("div");
        divBotones.style.display = "none"; divBotones.style.marginTop = "30px"; divBotones.style.gap = "15px"; divBotones.style.justifyContent = "center";

        if (indice > 0) {
            let btnRegresar = document.createElement("button");
            btnRegresar.innerText = "‚óÄ Regresar"; btnRegresar.style.background = "#555"; btnRegresar.style.color = "white";
            btnRegresar.onclick = () => clickNavegacion('prev');
            divBotones.appendChild(btnRegresar);
        }

        let btnSiguiente = document.createElement("button");
        btnSiguiente.innerText = (indice === mensajesLargos.length - 1) ? "Finalizar ‚ñ∂" : "Siguiente ‚ñ∂"; 
        btnSiguiente.style.background = "#00ffcc";
        btnSiguiente.onclick = () => clickNavegacion('next');
        divBotones.appendChild(btnSiguiente);

        contenedor.appendChild(divNombre);
        contenedor.appendChild(divAdornos);
        contenedor.appendChild(divTexto);
        contenedor.appendChild(divBotones);

        await escribirEfectoTexto(divTexto, mensajesLargos[indice], 50);
        divBotones.style.display = "flex";
        await new Promise(resolve => { resolveBotonClic = resolve; });

        if (direccionBoton === 'next') { indice++; } 
        else if (direccionBoton === 'prev') { indice--; }
    }

    // REGALO Y FINAL
    document.body.style.background = "linear-gradient(to right, #ff758c, #ff7eb3)";
    contenedor.innerHTML = `
        <div class="florPixel">üéÄ üéÅ üéÄ</div>
        <h1 style="font-size:40px; text-shadow: 0 0 10px white; animation: aparecer 1s forwards;">Tienes un regalo...</h1>
        <button onclick="abrirRegalo('${nombreUsuario}', ${esVIP})" style="font-size:20px; padding:15px 40px; background:#ffcc00; animation: aparecer 1.5s forwards;">
            Entrar
        </button>
    `;
}

async function abrirRegalo(nombreUsuario, esVIP) {
    const contenedor = document.getElementById("contenido");
    if (esVIP) {
        document.body.style.background = "linear-gradient(to right, #b30059, #800040)";
        contenedor.innerHTML = `
            <div class="florPixel" style="font-size: 50px;">üå∑ ‚ú® üå∑</div>
            <div style="font-size:28px; font-weight:bold; font-style:italic;">
                "Tenerte en mi vida es uno de los detalles m√°s bonitos que me han pasado."
            </div>
            <div style="font-size:20px; margin-top: 40px;">Att: Yeisson Orellana üòä</div>
            <br>
            <button onclick="window.location.href='especial.html?nombre=' + encodeURIComponent('${nombreUsuario}')" style="background:#ffcc00;">
                Abrir Sorpresa
            </button>
        `;
    } else {
        document.body.style.background = "linear-gradient(to right, #ff416c, #ff4b2b)";
        contenedor.innerHTML = `
            <div style="animation: aparecer 2s forwards;">
                <div style="font-size: 60px;">‚ù§Ô∏è</div>
                <div style="font-size: 22px; padding: 20px; border: 2px solid white; border-radius: 20px;">
                    Eres una persona maravillosa, capaz de lograr todo lo que te propongas.
                </div>
                <p>Espero haberte sacado una sonrisa üòä</p>
                
                <div id="zonaComentario" class="comentarios-section">
                    <p style="margin:0; font-weight:bold;">¬øQu√© te pareci√≥ el detalle?</p>
                    <textarea id="comentarioTexto" placeholder="Deja un mensaje aqu√≠..."></textarea>
                    <button onclick="enviarComentarioFinal('${nombreUsuario}')" style="background:#00ffcc; color:black;">Enviar comentario</button>
                </div>
                
                <div style="margin-top: 20px; font-size: 12px; opacity: 0.5;">
                    Hecho por Yeisson Orellana
                </div>
            </div>
        `;
        
        let n = nombreUsuario.toLowerCase();
        if(n.includes("karen") || n.includes("ivon")) {
            contenedor.innerHTML += `<div style="color:#ffde59; margin-top:10px;">¬°PD: Regaleme el llavero Karen! ü•≤</div>`;
        }
    }
}

async function enviarComentarioFinal(nombreUsuario) {
    const texto = document.getElementById("comentarioTexto").value;
    if(texto.trim() === "") return alert("Escribe algo antes de enviar üòä");
    const zona = document.getElementById("zonaComentario");
    zona.innerHTML = "<p>Enviando mensaje...</p>";
    await registrarEnExcel(nombreUsuario, "COMENTARIO", texto);
    zona.innerHTML = "<p style='color:#00ffcc; font-weight:bold;'>¬°Mensaje enviado! Gracias por tu tiempo. üòä</p>";
}
</script>
</body>
</html>
