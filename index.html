<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Plataforma Experimental</title>
<style>
    body { 
        margin: 0; 
        font-family: 'Segoe UI', Arial, sans-serif; 
        color: white; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        overflow: hidden; 
        transition: background 1.5s ease; 
        background: black; 
    }
    .container { text-align: center; width: 90%; max-width: 600px; padding: 20px; }
    input { padding: 12px; font-size: 16px; border-radius: 8px; border: none; text-align: center; color: #333; width: 80%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    button { 
        margin-top: 15px; 
        padding: 12px 25px; 
        border-radius: 8px; 
        border: none; 
        cursor: pointer; 
        background: #00c6ff; 
        color: black; 
        font-weight: bold; 
        font-size: 16px;
        box-shadow: 0 4px 15px rgba(0,198,255,0.4);
        transition: all 0.2s; 
    }
    button:hover { transform: scale(1.05); background: #00ffcc; }
    .progress-bar { width: 300px; height: 12px; background: #333; margin: 20px auto; border-radius: 10px; overflow: hidden; border: 1px solid #555; }
    .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00c6ff, #00ffcc); transition: width 0.3s; }
    .signal { font-size: 50px; animation: pulse 1s infinite; margin: 15px; }
    @keyframes pulse { 0% { opacity: 0.3; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.3; transform: scale(0.9); } }
    .flash { animation: flashScreen 0.1s infinite; }
    @keyframes flashScreen { 0% { background: black; } 50% { background: #440000; } 100% { background: black; } }
    .screenOff { background: black !important; }
    .bigMessage { font-size: 45px; font-weight: bold; color: #00ffcc; text-shadow: 0 0 20px #00ffcc; animation: fadeInZoom 2.5s ease forwards; }
    @keyframes fadeInZoom { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
    @keyframes aparecer { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    .florPixel { font-size: 45px; margin: 20px; animation: pulse 2s infinite; }
    .comentarios-section { 
        margin-top: 25px; 
        background: rgba(255, 255, 255, 0.15); 
        padding: 20px; 
        border-radius: 15px; 
        border: 1px solid rgba(0, 255, 204, 0.5); 
        backdrop-filter: blur(5px);
        animation: aparecer 1s ease;
    }
    textarea { width: 90%; height: 90px; border-radius: 10px; padding: 12px; margin-top: 10px; border: none; font-family: inherit; font-size: 15px; resize: none; background: rgba(255,255,255,0.9); color: #333; }
</style>
</head>
<body>
<div class="container" id="pantalla"></div>

<script>
const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbw821J3AeHNvY7VY2SGKQ4Zy573SJMMDcTBhfXaJEjFQUPapBzEq4j7U0pD3QSTY9OjUw/exec";
const params = new URLSearchParams(window.location.search);
const modo = params.get("modo");

const temas = {
    racing: { titulo: "üèç Telemetr√≠a Racing Pro", desc: "M√≥dulo de an√°lisis din√°mico de alto rendimiento.", col: "linear-gradient(135deg, #232526, #414345)" },
    deportes: { titulo: "‚öΩ Stats Deportivo Avanzado", desc: "Plataforma de procesamiento estad√≠stico competitivo.", col: "linear-gradient(135deg, #1d4350, #f45905)" },
    taller: { titulo: "üîß Workshop Digital Diagnostic", desc: "Sistema de escaneo y gesti√≥n de servicios t√©cnicos.", col: "linear-gradient(135deg, #2c3e50, #bdc3c7)" },
    ambiental: { titulo: "üåç Eco-Monitor Ambiental", desc: "Observatorio experimental de variables naturales.", col: "linear-gradient(135deg, #134e5e, #71b280)" }
};

let temaKey = modo === "especial1" ? "ambiental" : Object.keys(temas)[Math.floor(Math.random() * 3)];
let temaSeleccionado = temas[temaKey];

// PANTALLA INICIAL
document.body.style.background = temaSeleccionado.col;
document.getElementById("pantalla").innerHTML = `
    <div style="animation: aparecer 1s forwards;">
        <h2 style="text-shadow: 2px 2px 10px rgba(0,0,0,0.5);">Plataforma Experimental</h2>
        <p style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">Este sistema se encuentra en fase de pruebas din√°micas.</p>
        <p style="opacity:0.8; font-size:14px;">Acceso restringido - Versi√≥n 2.0.4</p>
        <br><button onclick="mostrarFormulario()">Acceder al Portal</button>
    </div>
`;

function mostrarFormulario() {
    document.getElementById("pantalla").innerHTML = `
        <div style="animation: aparecer 0.8s forwards;">
            <h1 style="text-transform: uppercase;">${temaSeleccionado.titulo}</h1>
            <p>${temaSeleccionado.desc}</p>
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-top: 20px;">
                <h3>Registro de Credenciales</h3>
                <input type="text" id="nombreInput" placeholder="Nombre completo del usuario">
                <br><button onclick="guardarNombre()">Validar Acceso</button>
                <p style="font-size:11px; color:#ffcc00; margin-top:15px; font-weight: bold;">
                    ‚ö†Ô∏è AVISO DE PRIVACIDAD: El administrador registrar√° el nombre del usuario y la marca de tiempo de entrada.
                </p>
            </div>
        </div>
    `;
}

async function registrarEnExcel(nombre, tipo, mensaje = "") {
    fetch(URL_GOOGLE_SCRIPT, { method: "POST", mode: "no-cors", body: JSON.stringify({ nombre, tipo, mensaje }) });
}

function guardarNombre() {
    let nom = document.getElementById("nombreInput").value.trim();
    if (!nom) return alert("Por favor, ingrese su nombre.");
    registrarEnExcel(nom, "ACCESO");
    iniciarSecuencia(nom);
}

function escribir(id, texto) {
    return new Promise(res => {
        let i = 0; const el = document.getElementById(id);
        const int = setInterval(() => { 
            el.innerHTML += texto[i]; i++; 
            if (i >= texto.length) { clearInterval(int); res(); } 
        }, 40);
    });
}

async function iniciarSecuencia(nomUsuario) {
    const cont = document.getElementById("pantalla");
    cont.innerHTML = `<h3>Iniciando protocolos...</h3><div class="signal">üì°</div>`;
    await new Promise(r => setTimeout(r, 2000));
    
    cont.innerHTML = `<h3>Sincronizando con el servidor central...</h3><div class="progress-bar"><div class="progress-fill" id="barra"></div></div>`;
    let a = 0; const b = document.getElementById("barra");
    const interval = setInterval(() => { a += 5; b.style.width = a + "%"; if (a >= 100) clearInterval(interval); }, 100);
    await new Promise(r => setTimeout(r, 2500));

    document.body.classList.add("flash");
    await new Promise(r => setTimeout(r, 1200));
    document.body.classList.remove("flash");
    document.body.style.background = "black";

    cont.innerHTML = `<div style="color:#ff3333; text-align:left; font-family:monospace; padding: 20px; border: 1px solid #ff3333; background: rgba(255,0,0,0.1);">
        CRITICAL_SYSTEM_ERROR: 0x8849<br>PROCESS_ABORTED: KERNEL_PANIC<br>----------------------------<br>
        <div id="r1" style="color:#00ffcc;"></div><div id="r2" style="color:#00ffcc;"></div>
    </div>`;
    await escribir("r1", "> Intentando recuperaci√≥n de sectores...");
    await escribir("r2", "> Reestableciendo entorno gr√°fico seguro...");
    await new Promise(r => setTimeout(r, 2000));

    document.body.classList.add("screenOff");
    await new Promise(r => setTimeout(r, 1500));
    document.body.classList.remove("screenOff");

    cont.innerHTML = `<div class="bigMessage">"Respira...<br>todo est√° bajo control."</div>`;
    await new Promise(r => setTimeout(r, 4000));

    let n = nomUsuario.toLowerCase();
    let esVIP = (modo === "especial1") && (n.includes("maria") || n.includes("fer") || n.includes("kim") || n.includes("pamela") || n.includes("silvia") || n.includes("tatiana"));
    let esKaren = n.includes("karen");

    mostrarMensajesIterativos(nomUsuario, esVIP, esKaren);
}

async function mostrarMensajesIterativos(nom, vip, karen) {
    const cont = document.getElementById("pantalla");
    document.body.style.background = "linear-gradient(to bottom, #1e3c72, #2a5298)";
    
    const frases = [
        "A veces la vida nos pone pruebas para recordarnos lo valientes que somos.",
        "Tu historia tiene cap√≠tulos hermosos que el destino a√∫n est√° guardando.",
        "Eres una persona llena de luz, nunca dejes que nadie apague tu brillo."
    ];

    for (let i = 0; i < frases.length; i++) {
        cont.innerHTML = `
            <div style="animation: aparecer 0.8s forwards;">
                <div class="florPixel">‚ú® üå∏ ‚ú®</div>
                <p style="font-size:24px; line-height:1.5; padding: 0 10px;">${frases[i]}</p>
                <button onclick="siguienteMsg()">Continuar leyendo</button>
            </div>`;
        await new Promise(res => window.siguienteMsg = res);
    }

    // FINAL PERSONALIZADO
    document.body.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
    if (vip) {
        cont.innerHTML = `
            <div style="animation: aparecer 1s forwards;">
                <h1 style="color:#ffcc00; text-shadow: 0 0 15px gold;">üéÅ Tienes un regalo especial</h1>
                <p style="font-size: 20px;">Este espacio fue dise√±ado solo para ti.</p>
                <button onclick="window.location.href='especial.html?nombre=${encodeURIComponent(nom)}'">ABRIR MI SORPRESA</button>
            </div>`;
    } else if (karen) {
        cont.innerHTML = `<h1>¬°Hola Karen! ‚ú®</h1><p>Qu√© alegr√≠a que hayas llegado hasta aqu√≠.</p>${formComentarios(nom)}`;
    } else {
        cont.innerHTML = `<h1>¬°Gracias por participar!</h1><p>Espero haber alegrado un poco tu d√≠a.</p>${formComentarios(nom)}`;
    }
}

function formComentarios(nom) {
    return `
        <div id="zonaCom" class="comentarios-section">
            <p style="margin-bottom: 5px; font-weight: bold;">¬øTe gustar√≠a dejar un mensaje o comentario?</p>
            <textarea id="txtC" placeholder="Escribe lo que sientas aqu√≠..."></textarea>
            <br><button id="btnE" onclick="enviarComentario('${nom}')">Enviar Mensaje</button>
        </div>
        <p style="font-size:11px; margin-top:30px; opacity:0.6;">Desarrollado por Yeisson Moises Orellana Grande</p>`;
}

async function enviarComentario(nom) {
    const t = document.getElementById("txtC").value;
    if (!t.trim()) return alert("Por favor, escribe algo antes de enviar.");
    document.getElementById("btnE").disabled = true;
    document.getElementById("btnE").innerText = "Enviando...";
    await registrarEnExcel(nom, "COMENTARIO", t);
    document.getElementById("zonaCom").innerHTML = "<h3 style='color:#00ffcc;'>¬°Mensaje enviado correctamente! üòä</h3>";
}
</script>
</body>
</html>
