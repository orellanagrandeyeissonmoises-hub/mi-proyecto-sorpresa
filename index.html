<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Plataforma Experimental</title>
<style>
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; transition: background 1.5s ease; background: black; }
    .container { text-align: center; width: 90%; max-width: 600px; padding: 20px; }
    input { padding: 12px; font-size: 16px; border-radius: 8px; border: none; text-align: center; color: #333; width: 80%; }
    button { margin-top: 15px; padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer; background: #00c6ff; color: black; font-weight: bold; transition: transform 0.2s; }
    button:hover { transform: scale(1.05); }
    .progress-bar { width: 300px; height: 10px; background: #333; margin: 20px auto; border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; background: #00ffcc; transition: width 0.3s; }
    .signal { font-size: 40px; animation: pulse 1s infinite; }
    @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 1; } 100% { opacity: 0.3; } }
    .flash { animation: flashScreen 0.1s infinite; }
    @keyframes flashScreen { 0% { background: black; } 50% { background: #330000; } 100% { background: black; } }
    .screenOff { background: black !important; }
    .bigMessage { font-size: 45px; font-weight: bold; color: #00ffcc; text-shadow: 0 0 15px #00ffcc; animation: fadeInZoom 2s ease forwards; }
    @keyframes fadeInZoom { 0% { opacity: 0; transform: scale(0.7); } 100% { opacity: 1; transform: scale(1); } }
    @keyframes aparecer { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .florPixel { font-size: 35px; margin-top: 15px; margin-bottom: 15px; letter-spacing: 10px; }
    .comentarios-section { margin-top: 25px; background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; border: 1px solid #00ffcc; }
    textarea { width: 90%; height: 80px; border-radius: 8px; padding: 10px; margin-top: 10px; border: none; font-family: inherit; resize: none; }
</style>
</head>
<body>
<div class="container" id="pantalla"></div>

<script>
const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbw821J3AeHNvY7VY2SGKQ4Zy573SJMMDcTBhfXaJEjFQUPapBzEq4j7U0pD3QSTY9OjUw/exec";
const params = new URLSearchParams(window.location.search);
const modo = params.get("modo");

const temas = {
    racing: { titulo: "üèç Simulaci√≥n de Telemetr√≠a Racing", desc: "Sistema piloto de pruebas din√°micas urbanas." },
    deportes: { titulo: "‚öΩ Plataforma de An√°lisis Deportivo", desc: "Evaluaci√≥n estad√≠stica avanzada de rendimiento." },
    taller: { titulo: "üîß Diagn√≥stico Inteligente de Talleres", desc: "Evaluaci√≥n digital de servicios t√©cnicos." },
    ambiental: { titulo: "üåç Proyecto de Observaci√≥n Ambiental", desc: "Monitoreo natural de ecosistemas protegidos." }
};

let temaSeleccionado = modo === "especial1" ? temas.ambiental : temas[Object.keys(temas)[Math.floor(Math.random() * 3)]];

// PANTALLA 1: INICIO
document.getElementById("pantalla").innerHTML = `
    <h2>Plataforma en fase experimental</h2>
    <p>Este sistema se encuentra en desarrollo.</p>
    <p style="opacity:0.6;font-size:14px;">Versi√≥n Beta - Acceso limitado</p>
    <br><button onclick="mostrarFormulario()">Entrar al sistema</button>
`;

function mostrarFormulario() {
    document.getElementById("pantalla").innerHTML = `
        <h1>${temaSeleccionado.titulo}</h1>
        <p>${temaSeleccionado.desc}</p>
        <br><h3>Registro de Acceso</h3>
        <input type="text" id="nombreInput" placeholder="Tu nombre completo">
        <br><button onclick="guardarNombre()">Registrar acceso</button>
        <p style="font-size:11px; color:#ffcc00; margin-top:15px;">‚ö†Ô∏è El desarrollador registrar√° nombre, fecha y hora de acceso.</p>
    `;
}

async function registrarEnExcel(nombre, tipo, mensaje = "") {
    fetch(URL_GOOGLE_SCRIPT, { method: "POST", mode: "no-cors", body: JSON.stringify({ nombre, tipo, mensaje }) });
}

function guardarNombre() {
    let nom = document.getElementById("nombreInput").value.trim();
    if (!nom) return alert("Ingresa tu nombre");
    registrarEnExcel(nom, "ACCESO");
    iniciarSecuencia(nom);
}

// FUNCIONES DE EFECTOS
function escribir(id, texto) {
    return new Promise(res => {
        let i = 0; const el = document.getElementById(id);
        const int = setInterval(() => { el.innerHTML += texto[i]; i++; if (i >= texto.length) { clearInterval(int); res(); } }, 40);
    });
}

async function iniciarSecuencia(nomUsuario) {
    const cont = document.getElementById("pantalla");
    document.body.style.background = "#0f2027";
    cont.innerHTML = `<div>Cargando...</div><div class="signal">üì°</div>`;
    await new Promise(r => setTimeout(r, 2000));
    
    cont.innerHTML = `<div>Sincronizando...</div><div class="progress-bar"><div class="progress-fill" id="barra"></div></div>`;
    let a = 0; const b = document.getElementById("barra");
    const interval = setInterval(() => { a += 5; b.style.width = a + "%"; if (a >= 100) clearInterval(interval); }, 100);
    await new Promise(r => setTimeout(r, 2500));

    document.body.classList.add("flash");
    await new Promise(r => setTimeout(r, 1000));
    document.body.classList.remove("flash");
    document.body.style.background = "black";

    cont.innerHTML = `<div style="color:red; text-align:left; font-family:monospace; margin-left:10%;">
        ERROR_CODE: 0x784AF9<br>STACK_TRACE: FAILURE<br><br>
        <div id="r1" style="color:#00ffcc;"></div><div id="r2" style="color:#00ffcc;"></div>
    </div>`;
    await escribir("r1", "> Fallo detectado. Reiniciando n√∫cleo...");
    await escribir("r2", "> Restaurando interfaz gr√°fica...");
    await new Promise(r => setTimeout(r, 2000));

    cont.innerHTML = `<div class="bigMessage">"Respira... todo est√° bajo control."</div>`;
    await new Promise(r => setTimeout(r, 3500));

    let n = nomUsuario.toLowerCase();
    let esVIP = (modo === "especial1") && (n.includes("maria") || n.includes("fer") || n.includes("kim") || n.includes("pamela") || n.includes("silvia") || n.includes("tatiana"));
    let esKaren = n.includes("karen");

    mostrarMensajesLargos(nomUsuario, esVIP, esKaren);
}

async function mostrarMensajesLargos(nom, vip, karen) {
    const cont = document.getElementById("pantalla");
    document.body.style.background = "linear-gradient(to right, #6a11cb, #2575fc)";
    
    const lista = [
        "A veces la vida nos pone pruebas para recordarnos de qu√© estamos hechos.",
        "Tu historia tiene cap√≠tulos hermosos que a√∫n no se han escrito.",
        "Eres una persona incre√≠ble, capaz de brillar incluso en la oscuridad."
    ];

    for (let i = 0; i < lista.length; i++) {
        cont.innerHTML = `
            <div style="animation: aparecer 0.8s forwards;">
                <div class="florPixel">üå∏</div>
                <p style="font-size:22px;">${lista[i]}</p>
                <button onclick="siguienteMensaje()">Siguiente</button>
            </div>`;
        await new Promise(res => window.siguienteMensaje = res);
    }

    if (vip) {
        cont.innerHTML = `<h1>üéÅ Tienes un regalo</h1><button onclick="window.location.href='especial.html?nombre=${encodeURIComponent(nom)}'">ABRIR SORPRESA</button>`;
    } else if (karen) {
        cont.innerHTML = `<h1>Hola Karen ‚ú®</h1><p>Gracias por estar aqu√≠.</p>${htmlComentarios(nom)}`;
    } else {
        cont.innerHTML = `<h1>¬°Gracias por venir!</h1><p>Espero haberte sacado una sonrisa.</p>${htmlComentarios(nom)}`;
    }
}

function htmlComentarios(nom) {
    return `
        <div id="zonaCom" class="comentarios-section">
            <p>¬øQu√© te pareci√≥ el detalle?</p>
            <textarea id="txtC" placeholder="Tu mensaje aqu√≠..."></textarea>
            <br><button id="btnE" onclick="enviarC('${nom}')">Enviar Comentario</button>
        </div>
        <p style="font-size:10px; margin-top:20px; opacity:0.5;">By Yeisson Orellana</p>`;
}

async function enviarC(nom) {
    const t = document.getElementById("txtC").value;
    if (!t) return alert("Escribe algo");
    document.getElementById("btnE").innerText = "Enviando...";
    await registrarEnExcel(nom, "COMENTARIO", t);
    document.getElementById("zonaCom").innerHTML = "<p>¬°Enviado! üòä</p>";
}
</script>
</body>
</html>
