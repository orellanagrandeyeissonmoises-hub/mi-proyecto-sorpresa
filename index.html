<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Plataforma Experimental</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, Arial, sans-serif;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* Cambiado de height a min-height para mejor scroll en m√≥vil */
    overflow-x: hidden;
    transition: background 1.5s ease;
    background: black;
}

.container {
    text-align: center;
    width: 95%; /* Ocupa casi todo el ancho en m√≥viles */
    max-width: 600px;
    padding: 15px;
    box-sizing: border-box;
}

h1 { font-size: 1.8rem; }
h2 { font-size: 1.5rem; }

input {
    padding: 15px; /* M√°s espacio para escribir en m√≥vil */
    font-size: 16px; /* Evita que el iPhone haga zoom autom√°tico */
    border-radius: 8px;
    border: none;
    text-align: center;
    color: #333;
    width: 90%;
    margin-bottom: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

button {
    margin-top: 15px;
    padding: 15px 30px; /* Botones m√°s grandes para dedos */
    font-size: 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #00c6ff;
    color: black;
    font-weight: bold;
    width: auto;
    min-width: 150px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,198,255,0.3);
    -webkit-tap-highlight-color: transparent; /* Quita el cuadro azul al tocar en Android */
}

.progress-bar {
    width: 80%;
    max-width: 300px;
    height: 14px;
    background: #333;
    margin: 20px auto;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid #444;
}

.progress-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #00c6ff, #00ffcc);
    transition: width 0.3s;
}

.signal { font-size: 50px; animation: pulse 1s infinite; }

@keyframes pulse {
    0% { opacity: 0.3; transform: scale(0.9); }
    50% { opacity: 1; transform: scale(1); }
    100% { opacity: 0.3; transform: scale(0.9); }
}

.flash { animation: flashScreen 0.1s infinite; }
@keyframes flashScreen {
    0% { background: black; }
    50% { background: #440000; }
    100% { background: black; }
}

.screenOff { background: black !important; }

.bigMessage {
    font-size: 1.8rem;
    padding: 0 10px;
    font-weight: bold;
    color: #00ffcc;
    text-shadow: 0 0 15px #00ffcc;
    animation: fadeInZoom 2s ease forwards;
}

@keyframes fadeInZoom {
    0% { opacity: 0; transform: scale(0.7); }
    100% { opacity: 1; transform: scale(1); }
}

@keyframes aparecer {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

.loveMessage {
    font-size: 1.6rem;
    color: white;
    margin-bottom: 20px;
    text-shadow: 0 0 10px white;
}

.mensajeBonito {
    font-size: 1.2rem;
    margin-top: 15px;
    padding: 0 15px;
    opacity: 0;
    transition: opacity 1s ease;
}

.florPixel {
    font-size: 30px;
    margin-top: 15px;
    margin-bottom: 15px;
    letter-spacing: 5px;
}

.comentarios-section {
    margin-top: 25px;
    background: rgba(255, 255, 255, 0.15);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid rgba(0, 255, 204, 0.5);
}

textarea {
    width: 95%;
    height: 80px;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    font-size: 16px;
    box-sizing: border-box;
}

.error-text {
    color: #ff3333;
    font-family: monospace;
    text-align: left;
    font-size: 12px;
    background: rgba(0,0,0,0.9);
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #ff0000;
    word-wrap: break-word; /* Evita que el texto se salga de la pantalla */
}

#notaOculta {
    display: none;
    position: fixed; 
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 99999;
    justify-content: center;
    align-items: center;
}

.nota-content {
    background: #111;
    padding: 25px;
    border-radius: 15px;
    border: 2px solid #00ffcc;
    max-width: 320px;
    width: 85%;
    text-align: center;
}
</style>
</head>

<body>

<div class="container" id="pantalla"></div>

<script>
// (Aqu√≠ sigue el mismo script que ya tienes, solo aseg√∫rate de usarlo tal cual)
// He mantenido toda tu l√≥gica de animaciones y registro.

const URL_GOOGLE_SCRIPT = "https://script.google.com/macros/s/AKfycbw821J3AeHNvY7VY2SGKQ4Zy573SJMMDcTBhfXaJEjFQUPapBzEq4j7U0pD3QSTY9OjUw/exec";

const params = new URLSearchParams(window.location.search);
const modo = params.get("modo");

const temasNormales = [
    {titulo:"üèç Telemetr√≠a Racing",descripcion:"Sistema piloto de pruebas din√°micas urbanas."},
    {titulo:"‚öΩ An√°lisis Deportivo",descripcion:"Evaluaci√≥n estad√≠stica avanzada de rendimiento."},
    {titulo:"üîß Diagn√≥stico de Talleres",descripcion:"Proyecto para evaluaci√≥n digital de servicios."}
];

const temaEspecial = {
    titulo:"üåç Observaci√≥n Ambiental",
    descripcion:"Plataforma experimental de monitoreo natural."
};

let temaSeleccionado;

if(modo==="especial1" || modo==="especial2" || modo==="especial3"){
    temaSeleccionado = temaEspecial;
    document.body.style.background="linear-gradient(to right,#134e5e,#71b280)";
}else{
    temaSeleccionado = temasNormales[Math.floor(Math.random()*temasNormales.length)];
    document.body.style.background="linear-gradient(to right,#0f2027,#203a43,#2c5364)";
}

document.getElementById("pantalla").innerHTML=`
    <div style="animation: aparecer 1s ease;">
        <h2>Plataforma Experimental</h2>
        <p>Sistema en desarrollo. Puede presentar comportamientos inesperados.</p>
        <p style="opacity:0.6;font-size:13px;">Versi√≥n Beta v2.0 - M√≥vil</p>
        <br>
        <button onclick="mostrarFormulario()">Entrar al sistema</button>
    </div>
`;

function mostrarFormulario(){
    document.getElementById("pantalla").innerHTML=`
    <div style="animation: aparecer 0.8s ease;">
        <h1>${temaSeleccionado.titulo}</h1>
        <p>${temaSeleccionado.descripcion}</p>
        <br>
        <h3>Reg√≠strate para continuar</h3>
        <input type="text" id="nombreInput" placeholder="Tu nombre aqu√≠">
        <br>
        <button onclick="guardarNombre()">Registrar acceso</button>
        <p style="font-size:11px;opacity:0.8;margin-top:15px; color: #ffcc00;">
        ‚ö†Ô∏è Depuraci√≥n activada: Registro de acceso habilitado.
        </p>
    </div>
    `;
}

function capitalizarNombre(nombre){
    return nombre.trim().toLowerCase().split(/\s+/)
    .map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(" ");
}

async function registrarEnExcel(nombre, tipo, mensaje = "") {
    try {
        fetch(URL_GOOGLE_SCRIPT, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nombre: nombre, tipo: tipo, mensaje: mensaje })
        });
    } catch (e) { console.error("Error de registro"); }
}

async function guardarNombre(){
    let nombre=document.getElementById("nombreInput").value.trim();
    if(nombre==="") return alert("Ingresa tu nombre");
    if(nombre.split(" ").length>4) return alert("M√°ximo cuatro palabras");
    nombre = capitalizarNombre(nombre);
    registrarEnExcel(nombre, "ACCESO", "Entr√≥ a la plataforma principal");
    iniciarSecuencia(nombre);
}

function pausa(ms){ return new Promise(resolve=>setTimeout(resolve,ms)); }

function animarBarra(){
    return new Promise(resolve=>{
        let ancho=0;
        const barra=document.getElementById("barra");
        const intervalo=setInterval(()=>{
            ancho+=5;
            barra.style.width=ancho+"%";
            if(ancho>=100){ clearInterval(intervalo); resolve(); }
        },150);
    });
}

function escribir(id,texto,velocidad){
    return new Promise(resolve=>{
        let i=0;
        const el=document.getElementById(id);
        const intervalo=setInterval(()=>{
            el.innerHTML+=texto[i];
            i++;
            if(i>=texto.length){ clearInterval(intervalo); resolve(); }
        },velocidad);
    });
}

function escribirEfectoTexto(elemento, texto, velocidad) {
    return new Promise(resolve => {
        let i = 0;
        const intervalo = setInterval(() => {
            elemento.innerHTML += texto[i];
            i++;
            if (i >= texto.length) { clearInterval(intervalo); resolve(); }
        }, velocidad);
    });
}

let resolveBotonClic;
let direccionBoton = 'next';
function clickNavegacion(dir) {
    direccionBoton = dir;
    if (resolveBotonClic) resolveBotonClic();
}

async function iniciarSecuencia(nombreUsuario){
    document.body.style.background="linear-gradient(to right,#0f2027,#203a43,#2c5364)";
    document.body.innerHTML=`<div class="container" id="contenido"></div>`;
    const contenido=document.getElementById("contenido");

    contenido.innerHTML=`<div>Sincronizando perfil...</div><div class="signal">üì°</div>`;
    await pausa(2000);

    contenido.innerHTML="";
    await escribir("contenido","Conectando v√≠a SSL segura...",40);
    await pausa(1000);

    contenido.innerHTML=`<div>Cargando m√≥dulos n√∫cleo...</div>
    <div class="progress-bar"><div class="progress-fill" id="barra"></div></div>`;
    await animarBarra();
    
    document.body.classList.add("flash");
    await pausa(1500); 
    document.body.classList.remove("flash");
    document.body.style.background="black";

    contenido.innerHTML=`
    <div class="error-text">
        [CRITICAL_SYSTEM_FAILURE]<br>
        ID: ACCESS_ERR_0x99<br>
        STATUS: KERNEL_PANIC<br>
        -------------------------<br>
        <div id="reinicio1"></div>
        <div id="reinicio2"></div>
        <div id="reinicio3"></div>
        <div id="reinicio4"></div>
        <div id="reinicio5"></div>
    </div>`;
    
    await escribir("reinicio1", "> Bypass cortafuegos...", 50);
    await pausa(800);
    await escribir("reinicio2", "> ERROR: Reintentando...", 50);
    await pausa(800);
    await escribir("reinicio3", "> Re-enrutando buffers...", 50);
    await pausa(1000);
    await escribir("reinicio4", "> Forzando controlador...", 60);
    await pausa(1200);
    await escribir("reinicio5", "> Recuperaci√≥n exitosa.", 40);
    await pausa(3000);

    document.body.classList.add("screenOff");
    contenido.innerHTML="";
    await pausa(3000); 
    document.body.classList.remove("screenOff");

    contenido.innerHTML=`<div class="bigMessage">"Todo est√° bajo control."</div>`;
    await pausa(4000);

    let nombreBuscado = nombreUsuario.toLowerCase();
    let esMaria = nombreBuscado.includes("maria") || nombreBuscado.includes("fer") || nombreBuscado.includes("vazquez");
    let esKimberly = nombreBuscado.includes("kimberly") || nombreBuscado.includes("kim") || nombreBuscado.includes("pamela");
    let esSilvia = nombreBuscado.includes("silvia") || nombreBuscado.includes("tatiana") || nombreBuscado.includes("esperanza");

    let esVIP = false;
    if ((modo === "especial1" || modo === "especial2" || modo === "especial3") && (esMaria || esKimberly || esSilvia)) {
        esVIP = true; 
    } 

    mostrarRutaCompartida(nombreUsuario, esVIP); 
}

async function mostrarRutaCompartida(nombreUsuario, esVIP) {
    let nombreFinal = capitalizarNombre(nombreUsuario).toUpperCase();
    document.body.style.background = "linear-gradient(to right, #b30059, #800040)";
    const contenedor = document.getElementById("contenido");

    const mensajesCortos = [
        "La vida tiene detalles hermosos para ti.",
        "Un pensamiento positivo cambia tu d√≠a.",
        "Tu luz es capaz de iluminar a otros.",
        "Hoy es una nueva oportunidad.",
        "Mereces todo lo bonito del mundo."
    ];
    mensajesCortos.sort(() => Math.random() - 0.5);

    contenedor.innerHTML = `
        <div class="loveMessage" style="animation: aparecer 1s ease;">üíñ BIENVENIDA(O) üíñ</div>
        <div class="florPixel">‚ú® üå∏ ü¶ã</div>
        <div id="mensajeSecuencia" class="mensajeBonito" style="min-height: 100px;"></div>
    `;

    const areaMensajes = document.getElementById("mensajeSecuencia");
    for(let i=0; i<3; i++){
        areaMensajes.style.opacity = "0";
        await pausa(500); 
        areaMensajes.innerText = mensajesCortos[i];
        areaMensajes.style.opacity = "1";
        await pausa(3000); 
    }

    document.body.style.background = "linear-gradient(to right, #6a11cb, #2575fc)"; 
    const mensajesLargos = [
        "Tienes una fuerza interior que te hace capaz de superar cualquier obst√°culo.",
        "No te compares con nadie, tu camino es √∫nico y tu ritmo es perfecto.",
        "Tu historia est√° llena de cap√≠tulos hermosos que a√∫n no se han escrito.",
        "Si√©ntete orgullosa de lo mucho que has crecido. Mereces reconocer tu esfuerzo."
    ];
    
    let indice = 0;
    while(indice < mensajesLargos.length){
        contenedor.innerHTML = "";
        let divNombre = document.createElement("div");
        divNombre.style.fontSize = "2.2rem"; divNombre.style.fontWeight = "bold";
        divNombre.style.color = "#ffcc00"; divNombre.style.marginBottom = "10px";
        divNombre.innerText = nombreFinal;
        
        let divAdornos = document.createElement("div");
        divAdornos.className = "florPixel"; divAdornos.innerText = "üå∏ ‚ú® üíñ";
        
        let divTexto = document.createElement("div");
        divTexto.style.fontSize = "1.2rem"; divTexto.style.lineHeight = "1.5"; divTexto.style.padding = "0 10px";

        let divBotones = document.createElement("div");
        divBotones.style.display = "none"; divBotones.style.marginTop = "30px"; divBotones.style.gap = "10px"; divBotones.style.justifyContent = "center";

        if (indice > 0) {
            let btnRegresar = document.createElement("button");
            btnRegresar.innerText = "‚óÄ"; btnRegresar.style.background = "#555"; btnRegresar.style.color = "white"; btnRegresar.style.minWidth = "80px";
            btnRegresar.onclick = () => clickNavegacion('prev');
            divBotones.appendChild(btnRegresar);
        }

        let btnSiguiente = document.createElement("button");
        btnSiguiente.innerText = (indice === mensajesLargos.length - 1) ? "Finalizar" : "Siguiente"; 
        btnSiguiente.style.background = "#00ffcc"; btnSiguiente.style.color="black";
        btnSiguiente.onclick = () => clickNavegacion('next');
        divBotones.appendChild(btnSiguiente);

        contenedor.appendChild(divNombre);
        contenedor.appendChild(divAdornos);
        contenedor.appendChild(divTexto);
        contenedor.appendChild(divBotones);

        await escribirEfectoTexto(divTexto, mensajesLargos[indice], 50);
        divBotones.style.display = "flex";
        await new Promise(resolve => { resolveBotonClic = resolve; });

        if (direccionBoton === 'next') { indice++; } 
        else if (direccionBoton === 'prev') { indice--; }
    }

    document.body.style.background = "linear-gradient(to right, #ff758c, #ff7eb3)";
    contenedor.innerHTML = `
        <div class="florPixel">üéÄ üéÅ üéÄ</div>
        <h1 style="text-shadow: 0 0 10px white;">Tienes un regalo...</h1>
        <button onclick="abrirRegalo('${nombreUsuario}', ${esVIP})" style="background:#ffcc00; font-size:1.2rem;">
            Abrir regalo
        </button>
    `;
}

async function abrirRegalo(nombreUsuario, esVIP) {
    const contenedor = document.getElementById("contenido");
    
    if (esVIP) {
        document.body.style.background = "linear-gradient(to right, #b30059, #800040)";
        contenedor.innerHTML = `
            <div style="animation: aparecer 1s ease;">
                <div class="florPixel" style="font-size: 50px;">üå∑ ‚ú® üå∑</div>
                <div style="font-size:1.4rem; font-weight:bold; font-style:italic; line-height:1.4;">
                    "Tenerte en mi vida es uno de los detalles m√°s bonitos."
                </div>
                <br>
                <button onclick="window.location.href='especial.html?nombre=' + encodeURIComponent('${nombreUsuario}')" style="background:#ffcc00;">
                    Ver Sorpresa
                </button>
            </div>
        `;
    } else {
        document.body.style.background = "linear-gradient(to right, #ff416c, #ff4b2b)";
        contenedor.innerHTML = `
            <div style="animation: aparecer 1s ease;">
                <div style="font-size: 60px;">‚ù§Ô∏è</div>
                <div style="font-size: 1.2rem; padding: 20px; border: 2px solid white; border-radius: 20px;">
                    Eres una persona maravillosa, capaz de lograr todo lo que te propongas.
                </div>
                <p>Espero haberte sacado una sonrisa üòä</p>
                <button onclick="mostrarSeccionFinal('${nombreUsuario}')" style="background:#00ffcc; color:black;">Continuar</button>
            </div>
        `;
    }
}

async function mostrarSeccionFinal(nombreUsuario) {
    const contenedor = document.getElementById("contenido");
    
    contenedor.innerHTML = `
        <div style="animation: aparecer 1s ease; padding-bottom: 40px;">
            
            <div id="zonaComentario" class="comentarios-section">
                <p style="margin:0; font-weight:bold;">¬øQu√© te pareci√≥?</p>
                <textarea id="comentarioTexto" placeholder="Escribe algo..."></textarea>
                <br>
                <button onclick="enviarComentarioFinal('${nombreUsuario}')" style="background:#00ffcc; width:100%;">Enviar</button>
            </div>

            <div id="mensajeExtra"></div>

            <div style="font-size:1.3rem; font-weight: bold; margin-top: 25px;">
                Att: Yeisson Orellana üòä
            </div>

            <div style="font-size: 3.5rem; color: #ffde59; margin-top: 30px; font-weight:900;">
                FIN
            </div>

            <div style="margin-top: 30px;">
                <span id="btnNota" style="font-size: 50px; cursor: pointer;">üìù</span>
                <p style="font-size: 12px;">Cr√©ditos</p>
            </div>
        </div>

        <div id="notaOculta">
            <div class="nota-content">
                <p style="color:white; font-size: 16px;">Creado por <br><b>Yeisson Moises Orellana Grande</b> con ayuda de IA.</p>
                <button id="btnCerrarNota" style="background:#ff3333; color:white;">Cerrar</button>
            </div>
        </div>
    `;

    document.getElementById("btnNota").onclick = () => {
        document.getElementById("notaOculta").style.display = "flex";
    };
    document.getElementById("btnCerrarNota").onclick = () => {
        document.getElementById("notaOculta").style.display = "none";
    };

    let n = nombreUsuario.toLowerCase();
    if(n.includes("karen") || n.includes("ivon")) {
        const divExtra = document.getElementById("mensajeExtra");
        divExtra.innerHTML = `
            <div style="background:rgba(255, 222, 89, 0.2); padding:15px; border-radius:15px; border: 2px solid #ffde59; margin-top:20px;">
                <p style="color:#ffde59; font-size: 1.5rem; font-weight: 900; margin:0;">
                    ¬°Reg√°leme el llavero Karen! ü•≤
                </p>
            </div>
        `;
    }
}

async function enviarComentarioFinal(nombreUsuario) {
    const texto = document.getElementById("comentarioTexto").value;
    if(texto.trim() === "") return alert("Escribe algo üòä");
    const zona = document.getElementById("zonaComentario");
    zona.innerHTML = "<p>Enviando...</p>";
    await registrarEnExcel(nombreUsuario, "COMENTARIO", texto);
    zona.innerHTML = "<p style='color:#00ffcc;'>¬°Mensaje enviado! Gracias. üòä</p>";
}
</script>
</body>
</html>
